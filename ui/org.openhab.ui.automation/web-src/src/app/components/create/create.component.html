<h1 class="headers">Create new rule</h1>
<div *ngIf="step == -2" class="creatediv">
    <h3>Devices could not be fetched. Please verify that openHAB is working correctly.</h3>
</div>
<div *ngIf="step == -1" class="creatediv">
    <h3>No devices could be found. Please add 1 or more devices before creating rules.</h3>
</div>
<div *ngIf="step == 0" class="loader">
	<mat-progress-spinner color="primary" mode="indeterminate"> </mat-progress-spinner>
</div>
<div *ngIf="step > 0" class="animate-from-right">
	<section>
		<div style="width: 60%; margin: auto; display: flex; align-items: center; justify-content: center">
			<div style="flex: 1;">
				<mat-progress-bar style="max-width: 75%; margin: auto;" color="primary" mode="determinate" [value]="(step - 1)*25"> </mat-progress-bar>
			</div>
			<button mat-icon-button (click)="cancel()" style="align-self: flex-end;">
				<mat-icon>close</mat-icon>
			</button>
		</div>
	</section>
</div>
<div *ngIf="step === 1" class="creatediv animate-from-right">
	<h2>Enter name and description</h2>
	<form>
		<mat-form-field style="width: 100%;"> <input matInput placeholder="Name" [formControl]="requiredFormControl" required [(ngModel)]="rule.name" name="name"> <mat-error *ngIf="requiredFormControl.hasError('required')">Please enter value</mat-error></mat-form-field>
		<mat-form-field style="width: 100%;"> <textarea matInput placeholder="Description" [(ngModel)]="rule.description" name="description"></textarea> </mat-form-field>
	</form>
	<div class="button-row">
		<button mat-raised-button (click)="cancel()">Cancel</button>
		<button mat-raised-button color="primary" [disabled]="requiredFormControl.hasError('required')" (click)="next();">Next</button>
	</div>
</div>
<div *ngIf="step === 2" class="creatediv animate-from-right">
	<div class="itemsdiv">
		<h2>What should activate the rule?</h2>
		<div class="events">
			<app-dynamic-component [things]="things" [mods]="rule.events" [moduleType]="'event'" (modUpdated)="onRuleUpdated($event)" (modDeleted)="onModDeleted($event)"></app-dynamic-component>
		</div>
	</div>
	<div class="button-row" style="clear: both;">
		<button mat-raised-button (click)="goBack()">Previous</button>
		<button mat-raised-button color="primary" [disabled]="isEventsZero()" (click)="next()">Next</button>
	</div>
</div>
<div *ngIf="step === 3" class="creatediv animate-from-right">
	<div class="itemsdiv">
		<h2>What should happen when the rule activates?</h2>
		<div class="actions">
			<app-dynamic-component [things]="thingsWithEditableItems" [mods]="rule.actions" [moduleType]="'action'" (modUpdated)="onRuleUpdated($event)" (modDeleted)="onModDeleted($event)"></app-dynamic-component>
		</div>
	</div>
	<div class="button-row">
		<button mat-raised-button (click)="goBack()">Previous</button>
		<button mat-raised-button color="primary" [disabled]="isActionsZero()" (click)="next()">Next</button>
	</div>
</div>
<div *ngIf="step === 4" class="creatediv animate-from-right">
    <div class="itemsdiv">
        <h2>Are there any conditions that needs to be met before your action should happen?</h2>
        <div class="conditions">
            <app-dynamic-component [things]="things" [mods]="rule.conditions" [moduleType]="'condition'" (modUpdated)="onRuleUpdated($event)" (modDeleted)="onModDeleted($event)"></app-dynamic-component>
        </div>
    </div>
    <div class="button-row">
        <button mat-raised-button (click)="goBack()">Previous</button>
        <button mat-raised-button color="primary" (click)="next()">Next</button>
    </div>
</div>
<div *ngIf="step === 5" class="creatediv animate-from-right" style="text-align: left; width: 50%;">
	<h2 style="text-align: center;">Overview</h2>
	<div style="display: flex; align-items: center;">
		<div style="width: 15%">
			<h3>
				<b>Name:</b>
			</h3>
		</div>
		<div style="width: 70%">
			<mat-form-field> <input matInput [formControl]="requiredFormControl" [(ngModel)]="rule.name"> </mat-form-field>
		</div>
	</div>
	<div style="display: flex; align-items: center;">
		<div style="width: 15%">
			<h3>
				<b>Description:</b>
			</h3>
		</div>
		<div style="width: 70%">
			<mat-form-field> <textarea matInput [(ngModel)]="rule.description"></textarea> </mat-form-field>
		</div>
	</div>
	<div style="display: flex">
		<div style="width: 15%">
			<h3 style="margin: 16px 0 16px 0;">
				<b>When</b>
			</h3>
		</div>
		<div style="width: 70%">
			<app-dynamic-component [things]="things" [mods]="rule.events" [moduleType]="'event'" (modUpdated)="onRuleUpdated($event)" (modDeleted)="onModDeleted($event)" style="text-align: center; width: 80%"></app-dynamic-component>
		</div>
	</div>
	<hr style="width:70%">
	<div style="display: flex">
		<div style="width: 15%">
			<h3 style="margin: 16px 0 16px 0;">
				<b>Then</b>
			</h3>
		</div>
		<div style="width: 70%">
			<app-dynamic-component [things]="thingsWithEditableItems" [mods]="rule.actions" [moduleType]="'action'" (modUpdated)="onRuleUpdated($event)" (modDeleted)="onModDeleted($event)" style="text-align: center; width: 80%"></app-dynamic-component>
		</div>
	</div>
	<hr style="width:70%">
	<div style="display: flex">
		<div style="width: 15%">
			<h3 style="margin: 16px 0 16px 0;">
				<b>But only if</b>
			</h3>
		</div>
		<div style="width: 70%">
			<app-dynamic-component [things]="things" [mods]="rule.conditions" [moduleType]="'condition'" (modUpdated)="onRuleUpdated($event)" (modDeleted)="onModDeleted($event)" style="text-align: center; width: 80%"></app-dynamic-component>
		</div>
	</div>
	<hr style="width:70%">
	<div class="button-row">
		<button mat-raised-button (click)="goBack()">Previous</button>
		<button *ngIf="edit" mat-raised-button color="primary"  [disabled]="!requiredFormControl.valid || rule.events.length < 1 || rule.actions.length < 1" (click)="updateRule()">Update</button>
		<button *ngIf="!edit" mat-raised-button color="primary" [disabled]="!requiredFormControl.valid || rule.events.length < 1 || rule.actions.length < 1" (click)="createRule()">Create</button>
	</div>
	<div #bodyJson></div>
</div>
